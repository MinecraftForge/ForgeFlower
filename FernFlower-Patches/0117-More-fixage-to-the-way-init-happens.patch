From 7465233a204d2523968638a0275020cd84cdb571 Mon Sep 17 00:00:00 2001
From: cpw <cpw@weeksfamily.ca>
Date: Sun, 8 Nov 2015 16:18:49 -0500
Subject: [PATCH 117/122] More fixage to the way init happens.

---
 .../jetbrains/java/decompiler/main/DecompilerContext.java   | 6 +++---
 src/org/jetbrains/java/decompiler/main/Fernflower.java      | 4 +---
 2 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/src/org/jetbrains/java/decompiler/main/DecompilerContext.java b/src/org/jetbrains/java/decompiler/main/DecompilerContext.java
index 22ab9e0..f946bb4 100644
--- a/src/org/jetbrains/java/decompiler/main/DecompilerContext.java
+++ b/src/org/jetbrains/java/decompiler/main/DecompilerContext.java
@@ -57,19 +57,19 @@ public class DecompilerContext {
     this.properties = properties;
   }
 
-  public static void initContext(Map<String, Object> propertiesCustom) {
+  public static void initContext(Map<String, Object> propertiesCustom, IFernflowerLogger logger) {
     Map<String, Object> properties = new HashMap<String, Object>(IFernflowerPreferences.DEFAULTS);
     if (propertiesCustom != null) {
       properties.putAll(propertiesCustom);
     }
     currentContext.set(new DecompilerContext(properties));
+    setLogger(logger);
     // Default a no-op renamer factory if none is provided
     if (DecompilerContext.getProperty(RENAMER_FACTORY) != null) {
       try {
         currentContext.get().renamerFactory = Class.forName((String) DecompilerContext.getProperty(RENAMER_FACTORY)).asSubclass(IVariableNamingFactory.class).newInstance();
       } catch (Exception e) {
-        e.printStackTrace();
-        System.err.println("Error loading renamer factory class");
+        getLogger().writeMessage("Error loading renamer factory class", e);
       }
     }
     if (DecompilerContext.getNamingFactory() == null) {
diff --git a/src/org/jetbrains/java/decompiler/main/Fernflower.java b/src/org/jetbrains/java/decompiler/main/Fernflower.java
index 8319da8..320e250 100644
--- a/src/org/jetbrains/java/decompiler/main/Fernflower.java
+++ b/src/org/jetbrains/java/decompiler/main/Fernflower.java
@@ -41,10 +41,8 @@ public class Fernflower implements IDecompiledData {
 
   public Fernflower(IBytecodeProvider provider, IResultSaver saver, Map<String, Object> options, IFernflowerLogger logger) {
     structContext = new StructContext(saver, this, new LazyLoader(provider));
-    DecompilerContext.setLogger(logger);
-    DecompilerContext.initContext(options);
+    DecompilerContext.initContext(options,logger);
     DecompilerContext.setCounterContainer(new CounterContainer());
-    DecompilerContext.setLogger(logger);
 
     if (DecompilerContext.getOption(IFernflowerPreferences.INCLUDE_ENTIRE_CLASSPATH)) {
       addAllClasspath();
-- 
2.21.0.windows.1

