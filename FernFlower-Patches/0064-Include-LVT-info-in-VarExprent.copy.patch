From 19773bf44e7d8f1ddbf06fe60ede5677ad698e03 Mon Sep 17 00:00:00 2001
From: Lex Manos <LexManos@gmail.com>
Date: Fri, 2 Oct 2015 03:10:28 -0700
Subject: [PATCH 064/122] Include LVT info in VarExprent.copy

---
 .../modules/decompiler/exps/VarExprent.java      |  1 +
 .../decompiler/vars/VarDefinitionHelper.java     | 16 ++++++----------
 .../modules/decompiler/vars/VarProcessor.java    |  2 +-
 3 files changed, 8 insertions(+), 11 deletions(-)

diff --git a/src/org/jetbrains/java/decompiler/modules/decompiler/exps/VarExprent.java b/src/org/jetbrains/java/decompiler/modules/decompiler/exps/VarExprent.java
index 933b046..c85d889 100644
--- a/src/org/jetbrains/java/decompiler/modules/decompiler/exps/VarExprent.java
+++ b/src/org/jetbrains/java/decompiler/modules/decompiler/exps/VarExprent.java
@@ -82,6 +82,7 @@ public class VarExprent extends Exprent {
     var.setVersion(version);
     var.setClassDef(classDef);
     var.setStack(stack);
+    var.setLVT(lvt);
     return var;
   }
 
diff --git a/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarDefinitionHelper.java b/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarDefinitionHelper.java
index e294648..88dae4d 100644
--- a/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarDefinitionHelper.java
+++ b/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarDefinitionHelper.java
@@ -260,22 +260,18 @@ public class VarDefinitionHelper {
   }
 
   private LVTVariable findLVT(int index, Exprent exp) {
-    VarExprent var = null;
-
-    if (exp.type == Exprent.EXPRENT_ASSIGNMENT) {
-      AssignmentExprent ass = (AssignmentExprent)exp;
-      if (ass.getLeft().type == Exprent.EXPRENT_VAR) {
-        var = (VarExprent)ass.getLeft();
+    for (Exprent e : exp.getAllExprents(false)) {
+      LVTVariable lvt = findLVT(index, e);
+      if (lvt != null) {
+        return lvt;
       }
     }
-    else if (exp.type == Exprent.EXPRENT_VAR) {
-      var = (VarExprent)exp;
-    }
 
-    if (var == null) {
+    if (exp.type != Exprent.EXPRENT_VAR) {
       return null;
     }
 
+    VarExprent var = (VarExprent)exp;
     return var.getIndex() == index ? var.getLVT() : null;
   }
 
diff --git a/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarProcessor.java b/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarProcessor.java
index bbf17ad..89f24f3 100644
--- a/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarProcessor.java
+++ b/src/org/jetbrains/java/decompiler/modules/decompiler/vars/VarProcessor.java
@@ -166,7 +166,7 @@ public class VarProcessor {
   public void findLVT(VarExprent varExprent, int bytecodeOffset) {
     LVTVariable var = this.lvt == null ? null : lvt.find(varExprent.getIndex(), bytecodeOffset);
     if (var != null) {
-        varExprent.setLVT(var);
+      varExprent.setLVT(var);
     }
   }
 
-- 
2.21.0.windows.1

