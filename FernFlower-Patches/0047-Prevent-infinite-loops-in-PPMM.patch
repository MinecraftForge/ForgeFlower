From 613a1873954a310ee5ee18be6db5790e6ec74ba0 Mon Sep 17 00:00:00 2001
From: Lex Manos <LexManos@gmail.com>
Date: Sun, 13 Sep 2015 18:19:20 -0700
Subject: [PATCH 047/122] Prevent infinite loops in PPMM.

---
 .../java/decompiler/modules/decompiler/PPandMMHelper.java   | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/org/jetbrains/java/decompiler/modules/decompiler/PPandMMHelper.java b/src/org/jetbrains/java/decompiler/modules/decompiler/PPandMMHelper.java
index f39946d..db70f64 100644
--- a/src/org/jetbrains/java/decompiler/modules/decompiler/PPandMMHelper.java
+++ b/src/org/jetbrains/java/decompiler/modules/decompiler/PPandMMHelper.java
@@ -157,7 +157,11 @@ public class PPandMMHelper {
 
               exprentReplaced = true;
               if (!left.equals(econd)) {
-                remaps.put(new VarVersionPair((VarExprent)left), new VarVersionPair((VarExprent)econd));
+                VarVersionPair _old = new VarVersionPair((VarExprent)left);
+                VarVersionPair _new = new VarVersionPair((VarExprent)econd);
+                if (_old.var > _new.var) { // Try and prevent infinite loops here by only merging 'down'
+                  remaps.put(_old, _new);
+                }
               }
               return ret;
             }
-- 
2.21.0.windows.1

